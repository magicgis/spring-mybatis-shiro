<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SecurityModule">
	<!-- 设置1分钟缓存,缓存大小1024，采用最近最少使用算法 -->
	<cache readOnly="true" flushInterval="60000" size="10" eviction="LRU" />
	
	
	<resultMap type="SecurityModule" id="SecurityModuleResultMap">
	  <id property="id" column="id"/>
	  <result property="description" column="description"/>
	  <result property="name" column="name"/>
	  <result property="priority" column="priority"/>
	  <result property="url" column="url"/>
	  <result property="parentId" column="parentId"/>
	  <result property="sn" column="sn"/>
	  <result property="level" column="level"/>
	  <result property="createTime" column="create_time"/>
	</resultMap>
	
	<!-- ######模块###### -->
	<select id="SELECTS_LEVEL_MODULE" resultMap="SecurityModuleResultMap" resultType="list" parameterType="map">
		SELECT * FROM security_module 
		<where>
			<if test="level != null">
				level = #{level}
			</if>
			
			<if test="parentId != null">
				AND parent_id = #{parentId}
			</if>
		</where>
		ORDER BY priority ASC ;
	</select>
	
	<select id="SELECTS_BY_PARENTD" resultMap="SecurityModuleResultMap" resultType="list" parameterType="long">
		SELECT * FROM security_module WHERE parent_id = #{parentId} ORDER BY priority ASC ;
	</select>
	
	<select id="SELECT_BY_ID" resultType="SecurityModule" parameterType="long">
		SELECT * FROM security_module WHERE id = #{id} ORDER BY priority ASC ;
	</select>
	
	<select id="SELECTS_MODULE_BY_PARENTID_NAME" parameterType="map" resultMap="SecurityModuleResultMap" resultType="list">
	   SELECT * FROM security_module WHERE parent_id = #{parentId}  AND name = #{name} ORDER BY priority ASC ;
	</select>
	
	<insert id="INSERT_SECURITYMODULE" parameterType="SecurityModule">
		INSERT INTO security_module ( create_time , description , name , priority , url , parent_id , sn  )
		VALUES( #{createTime} , #{description} , #{name} , #{priority} , #{url} , #{parentId} , #{sn} );
	</insert>
	
	<update id="UPDATE_BY_ID" parameterType="SecurityModule">
		UPDATE security_user
		<set>
			<if test="description != null">
				description = #{description},
			</if>
			
			<if test="name != null">
				name = #{name},
			</if>
			
			<if test="priority != null">
				priority = #{priority},
			</if>
			
			<if test="url != null">
				url = #{url},
			</if>
			
			<if test="parentId != null">
				parent_id = #{parentId},
			</if>
			
			<if test="sn != null">
				sn = #{sn}
			</if>
			
			
		</set>
		
		<where> 
			<if test="id != null">
				id = #{id}
			</if>
		</where>
	</update>


	<delete id="DELETE_BY_ID" parameterType="long">
		DELETE FROM security_module WHERE id = #{id};
	</delete>
	
</mapper>